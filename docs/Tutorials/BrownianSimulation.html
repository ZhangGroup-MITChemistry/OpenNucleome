<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sphere Model: Brownian Dynamics &mdash; openNucleome 1.1.0 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/jupyter-sphinx.css" type="text/css" />
      <link rel="stylesheet" href="../_static/thebelab.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Ellipsoid Model: Nuclear Deformation" href="NuclearDeformation.html" />
    <link rel="prev" title="Sphere Model: Langevin Dynamics" href="LangevinSimulation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            openNucleome
          </a>
              <div class="version">
                1.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/Introduction.html">Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">OpenNucleome:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../OpenNucleome.html">openNucleome</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="LangevinSimulation.html">Sphere Model: Langevin Dynamics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sphere Model: Brownian Dynamics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Import-the-necessary-packages">Import the necessary packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Important-parameters">Important parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Initialize-the-system-(A-larger-damping-coefficient-for-the-Brownian-Dynamics)">Initialize the system (A larger damping coefficient for the Brownian Dynamics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Add-the-force-field">Add the force field</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Perform-the-simulation">Perform the simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="NuclearDeformation.html">Ellipsoid Model: Nuclear Deformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigsGeneration.html">Tutorials: Configuration Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigsRelaxation.html">Tutorials: Configuration Relaxation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigsSelection.html">Tutorials: Configuration Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="ComputeContactProb.html">Tutorials: Contact Probability Computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChrChrOptimization.html">Tutorials: Chromosome Chromosome Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChrNLOptimization.html">Tutorials: Chromosome Nuclear Landmarks Optimization</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">openNucleome</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Sphere Model: Brownian Dynamics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Tutorials/BrownianSimulation.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Sphere-Model:-Brownian-Dynamics">
<h1>Sphere Model: Brownian Dynamics<a class="headerlink" href="#Sphere-Model:-Brownian-Dynamics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Import-the-necessary-packages">
<h2>Import the necessary packages<a class="headerlink" href="#Import-the-necessary-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">parmed</span> <span class="k">as</span> <span class="nn">pmd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">platform</span>
<span class="kn">import</span> <span class="nn">mdtraj</span> <span class="k">as</span> <span class="nn">md</span>
<span class="kn">import</span> <span class="nn">simtk.openmm.app</span> <span class="k">as</span> <span class="nn">mmapp</span>
<span class="kn">import</span> <span class="nn">mdtraj.reporters</span>
<span class="kn">import</span> <span class="nn">simtk.unit</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">openNucleome</span> <span class="kn">import</span> <span class="n">OpenNucleome</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Important-parameters">
<h2>Important parameters<a class="headerlink" href="#Important-parameters" title="Permalink to this headline">¶</a></h2>
<p>We defined the important parameters in the next block. First, we set the transition probability between dP particles and P particles as 0.2, and the transition frequency as 4000. When creating the system, we set type 6, 7 as the dP and P particles, respectively, so we kept using 6, 7 here. In this example, we ran a simulation with total length of 100,000 steps, and output one configuration and the energy every 2000 steps.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_P_dP</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># Transition probability from P to dP</span>
<span class="n">prob_dP_P</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># Transition probability from dP to P</span>
<span class="n">transition_freq</span> <span class="o">=</span> <span class="mi">4000</span>
<span class="n">sampling_freq</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">dP_type</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">P_type</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">total_steps</span> <span class="o">=</span> <span class="mi">100000</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Initialize-the-system-(A-larger-damping-coefficient-for-the-Brownian-Dynamics)">
<h2>Initialize the system (A larger damping coefficient for the Brownian Dynamics)<a class="headerlink" href="#Initialize-the-system-(A-larger-damping-coefficient-for-the-Brownian-Dynamics)" title="Permalink to this headline">¶</a></h2>
<p>We first set up an example “model” of class “OpenNucleome” with the conserved temperature, damping coefficient, timestep, and the mass scale. In this folder, we also included the initial configuration “human.pdb” used for the simulation and created a system according to the initial configuration.</p>
<p>In this example, we freezed all the lamina beads, and would not consider the dynamics of the membrane, and that is why we set “False” (off) for membrane dynamics. Consequently, there was also no need to set the bond between lamina beads, so we set “None” for the variable “lam_bond”.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">OpenNucleome</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="c1"># 1.0: temperature (LJ reduced unit);</span>
                                           <span class="c1"># 0.1: damping coefficient (LJ reduced unit);</span>
                                           <span class="c1"># 0.005: timestep (LJ reduced unit);</span>
                                           <span class="c1"># 1.0: mass_scale</span>

<span class="n">PDB_file</span> <span class="o">=</span> <span class="s2">&quot;human.pdb&quot;</span> <span class="c1">#The initial configuration</span>

<span class="c1"># Generate new elements and construct topology as well</span>
<span class="c1"># flag_membrane: True for including lamina dynamics, False for excluding lamina dynamics;</span>
<span class="c1"># lam_bond: A file contains the lamina bond when membrane_dynamics is on.</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">create_system</span><span class="p">(</span><span class="n">PDB_file</span><span class="p">,</span> <span class="n">flag_membrane</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lam_bond</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Add-the-force-field">
<h2>Add the force field<a class="headerlink" href="#Add-the-force-field" title="Permalink to this headline">¶</a></h2>
<p>In this example, we loaded default settings for the interactions between chromosomes and chromosomes, and chromosomes and nuclear landmarks. All the types of potential can be found in “Section: Energy function of the whole nucleus model” in Supporting Information. According to the order of added potential, the index of speckle-speckle potential is 6, and this index is needed when transiting the speckle particle between type 6 and type 7.</p>
<p>Because during the simulations, we would transit the dP speckle and P speckle particles, here, we logged the start index and end index of speckle particle, and computed the number of speckle particles.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the default force field</span>
<span class="n">model</span><span class="o">.</span><span class="n">load_default_settings</span><span class="p">()</span>

<span class="n">index_spec_spec_potential</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">start_spec_index</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">N_chr_nuc</span><span class="o">+</span><span class="mi">1</span>
<span class="n">end_spec_index</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">N_chr_nuc_spec</span><span class="o">+</span><span class="mi">1</span>
<span class="n">N_spec</span> <span class="o">=</span> <span class="n">end_spec_index</span><span class="o">-</span><span class="n">start_spec_index</span> <span class="c1">#Currently, the number of speckle is 1600.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Perform-the-simulation">
<h2>Perform the simulation<a class="headerlink" href="#Perform-the-simulation" title="Permalink to this headline">¶</a></h2>
<p>We first created the simulation with a specific Platform, and here, we used “CUDA” but users can also use “CPU”, “Reference”, and “OpenCL” according to their hardware. Before the simulation, we minimized the energy to make the system much more reasonable and stable. After randomly setting velocity, we started our simulation with a total length of 100,000 steps and output the configuration and energy every 2000 steps, and change the speckle types every 4000 steps as we mentioned in the previous
blocks.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#model.save_system(&quot;model_before_simulation_0.xml&quot;)</span>

<span class="n">simulation</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">create_simulation</span><span class="p">(</span><span class="n">platform_type</span> <span class="o">=</span> <span class="s2">&quot;CUDA&quot;</span><span class="p">)</span> <span class="c1"># Users can also use CPU, Reference, OpenCL.</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">chr_positions</span><span class="p">)</span>

<span class="n">simulation</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">()</span>

<span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">DCDReporter</span><span class="p">(</span><span class="s1">&#39;step_100000.dcd&#39;</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">setVelocity</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kilojoule_per_mole</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">chr_system</span><span class="o">.</span><span class="n">getParticleMass</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">velocs</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">chr_system</span><span class="o">.</span><span class="n">getNumParticles</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)),</span>
                        <span class="n">u</span><span class="o">.</span><span class="n">meter</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">meter</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">setVelocities</span><span class="p">(</span><span class="n">velocs</span><span class="p">)</span>
<span class="n">setVelocity</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>

<span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mmapp</span><span class="o">.</span><span class="n">statedatareporter</span><span class="o">.</span><span class="n">StateDataReporter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kineticEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">remainingTime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">totalSteps</span> <span class="o">=</span> <span class="n">total_steps</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_steps</span><span class="o">//</span><span class="n">transition_freq</span><span class="p">):</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">transition_freq</span><span class="p">)</span>
    <span class="c1"># Change the type of speckles every 4000 steps, non-equilibrium scheme.</span>

    <span class="c1"># Do the chemical modification, and change the spec-spec potential on the fly.</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start_spec_index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_spec_index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_spec</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">compart_type</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">dP_type</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">compart_type</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">P_type</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_dP_P</span> <span class="k">else</span> <span class="n">dP_type</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">compart_type</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">dP_type</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_P_dP</span> <span class="k">else</span> <span class="n">P_type</span><span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Update the context after changing the type of speckles.</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">chr_system</span><span class="o">.</span><span class="n">getNumParticles</span><span class="p">()):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">chr_system</span><span class="o">.</span><span class="n">getForce</span><span class="p">(</span><span class="n">index_spec_spec_potential</span><span class="p">)</span><span class="o">.</span><span class="n">setParticleParameters</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">compart_type</span><span class="p">[</span><span class="n">m</span><span class="p">]])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">chr_system</span><span class="o">.</span><span class="n">getForce</span><span class="p">(</span><span class="n">index_spec_spec_potential</span><span class="p">)</span><span class="o">.</span><span class="n">updateParametersInContext</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>

<span class="c1"># Keep the final result of spec types in case constructing the configuration for the continuous simulation.</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;compt_final_frame.txt&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">compart_type</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
#&#34;Progress (%)&#34; &#34;Step&#34;  &#34;Potential Energy (kJ/mole)&#34;    &#34;Kinetic Energy (kJ/mole)&#34;      &#34;Temperature (K)&#34;       &#34;Time Remaining&#34;
2.0%    2000    99206.4412654699        94134.75300352147       120.68485641754191      --
4.0%    4000    102701.08388253691      93520.74826045646       119.89767557420642      12:09
6.0%    6000    104651.70612277067      93731.0734316584        120.16732161116528      11:56
8.0%    8000    105127.13949484381      94102.27174289225       120.64321402564917      11:39
10.0%   10000   105491.00636059525      93648.35121302649       120.06126812125216      11:25
12.0%   12000   105518.90546583151      94110.91761336563       120.65429840844503      11:09
14.0%   14000   106865.24930417407      93759.76601602121       120.20410675494682      10:55
16.0%   16000   106873.28149104537      94006.82493267559       120.52084705469554      10:39
18.0%   18000   107086.6011086256       94332.96452635451       120.93897222929225      10:24
20.0%   20000   106953.19238129302      93770.7734030736        120.21821870492879      10:09
22.0%   22000   107072.1334956935       93375.98766078262       119.71208617572037      9:54
24.0%   24000   107110.97032948714      94094.96829805299       120.63385069102878      9:38
26.0%   26000   106512.06788424458      93708.01118761621       120.13775480908535      9:23
28.0%   28000   107007.46950869502      93839.9939870647        120.30696251073441      9:08
30.0%   30000   106913.16918850449      93172.75310898616       119.45153062189934      8:53
32.0%   32000   106915.08454353464      93621.11060174042       120.0263444702424       8:38
34.0%   34000   107014.74365555328      93628.10619949324       120.0353131314798       8:23
36.0%   36000   107514.72947818661      94338.39525419394       120.94593465909243      8:07
38.0%   38000   107837.33129110897      93885.5290150697        120.36534040137958      7:52
40.0%   40000   106950.75294655675      93663.5151864481        120.08070899613328      7:37
42.0%   42000   107667.87119089549      93496.98710811744       119.86721274122651      7:22
44.0%   44000   107699.62504764477      94032.75748670635       120.55409371928948      7:06
46.0%   46000   107383.76271006957      94152.42564459662       120.70751351370058      6:51
48.0%   48000   107685.70053905711      93806.7296820601        120.26431622182174      6:36
50.0%   50000   108188.80864062146      93640.34363561436       120.05100205798222      6:21
52.0%   52000   107603.83933436283      94046.41163473742       120.57159893221092      6:06
54.0%   54000   108164.27943819607      93452.12713116668       119.80970029545641      5:50
56.0%   56000   108005.24750933856      93567.68193590513       119.95784659183748      5:35
58.0%   58000   108313.07388479386      94316.94933454806       120.91844005533957      5:20
60.0%   60000   108395.15716423347      94009.32902459751       120.52405740968571      5:05
62.0%   62000   108428.54042971827      94355.11724100974       120.96737297505427      4:49
64.0%   64000   107657.64817855803      93585.44734329867       119.98062261845973      4:34
66.0%   66000   107381.47411069873      93640.96555821148       120.05179938985957      4:19
68.0%   68000   107687.9018101579       93652.15958594646       120.06615062133174      4:03
70.0%   70000   107782.82429903571      94425.59704279248       121.05773115295452      3:48
72.0%   72000   107962.40978158862      93952.41600976083       120.45109244398809      3:33
74.0%   74000   107785.17330015628      93965.6979905636        120.46812052230115      3:18
76.0%   76000   108038.9673213207       94057.88412419827       120.58630716375303      3:02
78.0%   78000   108096.03393143494      94123.20937907144       120.67005698784311      2:47
80.0%   80000   108757.5499189049       93700.3455351824        120.12792710854114      2:32
82.0%   82000   108219.60951086738      94144.80773405787       120.69774702034677      2:17
84.0%   84000   108201.2584779624       93376.41183373508       119.71262998393394      2:01
86.0%   86000   108221.42426802675      93843.71725379101       120.31173590096417      1:46
88.0%   88000   108443.49560169622      93451.2561512716        119.80858366126738      1:31
90.0%   90000   108268.14389363492      93453.72473727254       119.81174849611925      1:16
92.0%   92000   107815.92389762413      93555.81712947131       119.94263539283604      1:00
94.0%   94000   108183.73701566845      93871.62747391993       120.3475180196968       0:45
96.0%   96000   108061.97408063925      93445.79320813327       119.80157993004984      0:30
98.0%   98000   108457.55532271703      94215.09866736185       120.78786306062499      0:15
100.0%  100000  107731.43794686723      93884.87048781736       120.36449614073875      0:00
</pre></div></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="LangevinSimulation.html" class="btn btn-neutral float-left" title="Sphere Model: Langevin Dynamics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="NuclearDeformation.html" class="btn btn-neutral float-right" title="Ellipsoid Model: Nuclear Deformation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Zhuohan Lao.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>